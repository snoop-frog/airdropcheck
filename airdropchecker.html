<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retorded Airdrop Checker</title>
    <style>
        body, textarea, button {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            line-height: 1.6;
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        #address-input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            resize: vertical;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            text-align: center; /* Center align table contents */
        }
        th, td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        tr:hover {background-color: #f5f5f5;}
        img {
            border-radius: 5px;
            max-width: 100px; /* Responsive images */
        }
        @media screen and (max-width: 600px) {
            .container {
                padding: 5px;
            }
            h1, h2 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Retorded Airdrop Checker</h1>
        Enter BTC Wallet Addresses (one per line, up to 50):<br>
        <textarea id="address-input"></textarea><br>
        <button onclick="fetchNFTData()">Show Collections</button>
        <h2>Total Collection Counts</h2>
        <table id="collection-summary">
            <thead>
                <tr>
                    <th>Collection Name</th>
                    <th>Count</th>
                    <th>Last 24hr</th> <!-- Header for new items in the last 24 hours -->
                </tr>
            </thead>
            <tbody id="collection-summary-body"></tbody>
        </table>
        <h2>Individual Wallet Collections</h2>
        <table id="nft-collections">
            <tbody id="individual-collections-body"></tbody>
        </table>
    </div>

    <script>
        async function fetchNFTData() {
            const addresses = document.getElementById('address-input').value.split('\n').slice(0, 50);
            const container = document.getElementById('individual-collections-body'); // Changed to target tbody
            const summaryContainer = document.getElementById('collection-summary-body'); // Changed to target tbody
            container.innerHTML = ''; // Clear previous results
            summaryContainer.innerHTML = ''; // Clear previous summary

            let totalCollections = {};
            let newInLast24h = {}; // Store new collections count here

            const oneDayAgo = new Date(new Date().getTime() - (24 * 60 * 60 * 1000)); // Time 24 hours ago

            for (let address of addresses) {
                address = address.trim();
                if (!address) continue;
                const shortAddress = address.substring(address.length - 5); // Get last 5 characters for better identification
                const url = `https://corsproxy.io/?${encodeURIComponent('https://api-mainnet.magiceden.io/v2/ord/btc/wallets/collections?ownerAddress=')}${address}`;
                try {
                    const response = await fetch(url);
                    const data = await response.json(); // Getting all collections

                    // Add to total count and track new items
                    data.forEach(collection => {
                        const createdAt = new Date(collection.createdAt);
                        totalCollections[collection.name] = (totalCollections[collection.name] || 0) + 1;
                        if (createdAt > oneDayAgo) {
                            newInLast24h[collection.name] = (newInLast24h[collection.name] || 0) + 1;
                        }
                    });

                    // Display individual collection information
                    data.forEach(collection => {
                        const row = container.insertRow(-1);
                        const cell1 = row.insertCell(0);
                        cell1.colSpan = 3; // Make sure this spans all columns
                        cell1.innerHTML = `<strong>Address: ...${shortAddress}</strong>`;
                        
                        const cell2 = row.insertCell(1);
                        cell2.innerHTML = `<img src="${collection.image}" alt="${collection.name}" style="width:100px;"> ${collection.name}`;
                    });
                } catch (error) {
                    console.error('Fetch error:', error);
                    const errorRow = container.insertRow(-1);
                    const errorCell = errorRow.insertCell(0);
                    errorCell.colSpan = 3; // Ensure this spans all columns for consistency
                    errorCell.innerHTML = `<strong>Error fetching collections for address: ...${shortAddress}</strong>`;
                }
            }

            // Display total collection counts and new in the last 24 hours in descending order
            const entries = Object.entries(totalCollections);
            const sortedEntries = entries.sort((a, b) => b[1] - a[1]); // Sort collections by count
            sortedEntries.forEach(([name, count]) => {
                const row = summaryContainer.insertRow(-1);
                const cell1 = row.insertCell(0);
                const cell2 = row.insertCell(1);
                const cell3 = row.insertCell(2); // Cell for new collections in the last 24h

                cell1.innerHTML = name;
                cell2.innerHTML = count;
                cell3.innerHTML = newInLast24h[name] || 0; // Show the count or 0 if none are new
            });
        }
    </script>
</body>
</html>

